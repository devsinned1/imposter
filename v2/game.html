<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Imposter Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-color: #2575fc;
            --primary-dark: #1c61d7;
            --accent-color: #6a11cb;
            --danger-color: #ff5252;
            --success-color: #4CAF50;
            --text-dark: #333;
            --text-light: #fff;
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            --header-height: 60px;
            --footer-height: 60px;
            --container-padding: 15px;
        }

        body {
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--primary-color) 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-light);
            overflow-x: hidden;
            position: relative;
            font-size: 16px;
        }

        @media (max-width: 360px) {
            body {
                font-size: 14px;
            }
        }

        .container {
            width: 100%;
            max-width: 500px;
            padding: var(--container-padding);
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: calc(100vh - var(--header-height) - var(--footer-height));
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }

        .container::-webkit-scrollbar {
            display: none; /* Chrome, Safari */
        }

        /* Typography */
        h1 {
            text-align: center;
            font-size: 2.2rem;
            margin: 10px 0;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        h2 {
            text-align: center;
            font-size: 1.6rem;
            margin-bottom: 15px;
        }

        /* Cards */
        .card {
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin: 10px 0;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .compact-card {
            padding: 15px;
        }

        .home-screen .card {
            margin-bottom: 20px;
        }

        /* Navigation */
        .nav-header {
            width: 100%;
            height: var(--header-height);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 0 20px;
        }

        .close-btn {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) rotate(90deg);
        }

        .close-btn::before,
        .close-btn::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 2px;
            background-color: white;
        }

        .close-btn::before {
            transform: rotate(45deg);
        }

        .close-btn::after {
            transform: rotate(-45deg);
        }

        /* Form Controls */
        .player-input {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            position: relative;
        }

        .player-input input {
            flex-grow: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }

        .player-input input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(37, 117, 252, 0.2);
        }

        .player-input label {
            min-width: 90px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .settings-row label {
            font-weight: 500;
        }

        .number-input {
            display: flex;
            align-items: center;
        }

        .number-btn {
            width: 36px;
            height: 36px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            color: var(--text-dark);
            border: none;
            outline: none;
        }

        .number-btn:active {
            transform: scale(0.95);
            background: #e0e0e0;
        }

        .number-display {
            margin: 0 15px;
            font-size: 1.2rem;
            min-width: 30px;
            text-align: center;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:focus + .toggle-slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Buttons */
        .btn {
            display: block;
            width: 100%;
            padding: 15px 20px;
            background: var(--primary-color);
            color: var(--text-light);
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 0 4px 10px rgba(37, 117, 252, 0.2);
            margin: 15px 0;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(37, 117, 252, 0.3);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 8px rgba(37, 117, 252, 0.2);
        }

        .btn-small {
            padding: 10px;
            font-size: 0.9rem;
            margin: 10px 0;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: rgba(37, 117, 252, 0.1);
        }

        .btn-danger {
            background: var(--danger-color);
        }

        .btn-danger:hover {
            background: #e64a4a;
        }

        /* Screens */
        .screen {
            width: 100%;
            height: 100%;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            opacity: 1;
        }

        /* Home Screen Specific */
        .category-selection {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .category-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .category-checkbox input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Game Cards */
        .game-scene {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            perspective: 2000px;
            overflow: hidden;
            position: relative;
        }

        .cards-container {
            width: 100%;
            height: 100%;
            max-height: 500px;
            position: relative;
            transform-style: preserve-3d;
            perspective: 2000px;
        }

        .name-card,
        .word-card {
            position: absolute;
            width: 85%;
            height: 70%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backface-visibility: hidden;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform-origin: center center;
        }

        .name-card {
            background: var(--card-bg);
            color: var(--text-dark);
            z-index: 2;
            transform: translate(-50%, -50%) rotateX(0deg);
        }

        .word-card {
            background: var(--primary-color);
            color: var(--text-light);
            z-index: 1;
            transform: translate(-50%, -50%) rotateX(-180deg);
        }

        .cards-flipped .name-card {
            transform: translate(-50%, -50%) rotateX(180deg);
        }

        .cards-flipped .word-card {
            transform: translate(-50%, -50%) rotateX(0deg);
        }

        .cards-container.reset-animation {
            transition: none;
        }

        .player-name {
            font-size: 2rem;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
            padding: 0 20px;
        }

        .tap-instruction {
            font-size: 1rem;
            color: #777;
            margin-top: 30px;
            text-align: center;
        }

        .word-reveal {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 20px 0;
            text-align: center;
            padding: 0 20px;
        }

        .imposter-text {
            color: var(--danger-color);
            font-weight: bold;
        }

        .hint-text {
            font-size: 1.2rem;
            margin-top: 15px;
            font-style: italic;
            text-align: center;
            padding: 0 20px;
        }

        .swipe-instruction {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: #777;
            font-size: 0.9rem;
            animation: fadeInOut 2s infinite;
        }

        .category-badge {
            position: absolute;
            top: 20px;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
        }

        @keyframes fadeInOut {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }

        .arrow-up {
            display: block;
            width: 20px;
            height: 20px;
            border-left: 2px solid #777;
            border-top: 2px solid #777;
            transform: rotate(45deg);
            margin: 5px auto;
        }

        /* Result Screen */
        .result-screen {
            text-align: center;
        }

        .question-mark {
            font-size: 8rem;
            margin: 40px 0;
            color: white;
            text-shadow: 0 0 20px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .imposter-reveal {
            font-size: 1.8rem;
            margin: 20px 0;
        }

        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .game-footer {
            width: 100%;
            padding: 10px 20px;
            text-align: center;
        }

        .player-progress {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
        }

        .progress-dot.active {
            background: white;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            top: -10px;
            animation: fall linear forwards;
            z-index: 1000;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
            }
        }

        .theme-switch-container {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 10px;
        }

        .theme-switch-container span {
            margin-right: 8px;
            font-size: 0.85rem;
        }

        body.dark-theme {
            --card-bg: rgba(40, 44, 52, 0.95);
            --text-dark: #e6e6e6;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body.dark-theme .card,
        body.dark-theme .accordion-header {
            color: var(--text-light);
        }

        body.dark-theme .number-btn {
            background: #444;
            color: #e6e6e6;
        }

        body.dark-theme .name-card {
            background: rgba(40, 44, 52, 0.95);
            color: var(--text-light);
        }

        body.dark-theme .player-input input {
            background: rgba(255, 255, 255, 0.1);
            border-color: #444;
            color: var(--text-light);
        }

        /* Loading animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid transparent;
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .btn-disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-disabled:hover {
            transform: none;
            box-shadow: 0 4px 10px rgba(37, 117, 252, 0.2);
        }
    </style>
</head>
<body>
    <!-- HOME SCREEN -->
    <div class="screen home-screen active" id="home-screen">
        <div class="nav-header">
            <h1>Imposter</h1>
            <div class="theme-switch-container">
                <span>üåô</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="theme-toggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
        
        <div class="container">
            <div class="card">
                <h2>Spieler</h2>
                <div id="players-container">
                    <!-- Player inputs will be generated here -->
                </div>
                
                <div class="settings-row">
                    <label>Anzahl der Spieler:</label>
                    <div class="number-input">
                        <button class="number-btn" id="decrease-players">-</button>
                        <div class="number-display" id="player-count">3</div>
                        <button class="number-btn" id="increase-players">+</button>
                    </div>
                </div>
            </div>
            
            <div class="card compact-card">
                <h2>Spieleinstellungen</h2>
                <div class="settings-row">
                    <label>Anzahl der Imposter:</label>
                    <div class="number-input">
                        <button class="number-btn" id="decrease-imposters">-</button>
                        <div class="number-display" id="imposter-count">1</div>
                        <button class="number-btn" id="increase-imposters">+</button>
                    </div>
                </div>
                
                <div class="settings-row">
                    <label>Tipps f√ºr Imposter:</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="imposter-tips">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="card compact-card">
                <h2>Kategorien</h2>
                <div class="settings-row">
                    <button class="btn btn-small btn-outline" id="select-all-categories">Alle ausw√§hlen</button>
                    <button class="btn btn-small btn-outline" id="deselect-all-categories">Alle abw√§hlen</button>
                </div>
                
                <div class="category-selection">
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-animals" value="Tiere" checked>
                        <label for="category-animals">ü¶Å Tiere</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-food" value="Essen" checked>
                        <label for="category-food">üçî Essen</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-countries" value="L√§nder" checked>
                        <label for="category-countries">üåç L√§nder</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-cities" value="St√§dte" checked>
                        <label for="category-cities">üèôÔ∏è St√§dte</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-jobs" value="Berufe" checked>
                        <label for="category-jobs">üë®‚Äç‚öïÔ∏è Berufe</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-sports" value="Sport" checked>
                        <label for="category-sports">‚öΩ Sport</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-movies" value="Filme & Serien" checked>
                        <label for="category-movies">üé¨ Filme & Serien</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-music" value="Musik" checked>
                        <label for="category-music">üéµ Musik</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-tech" value="Technologie" checked>
                        <label for="category-tech">üì± Technologie</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-games" value="Videospiele" checked>
                        <label for="category-games">üéÆ Videospiele</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-heroes" value="Superhelden" checked>
                        <label for="category-heroes">ü¶∏ Superhelden</label>
                    </div>
                    <div class="category-checkbox">
                        <input type="checkbox" id="category-clothes" value="Kleidung" checked>
                        <label for="category-clothes">üëï Kleidung</label>
                    </div>
                </div>
            </div>
            
            <button class="btn" id="start-game">Spiel Starten</button>
        </div>
    </div>
    
    <!-- GAME SCREEN -->
    <div class="screen" id="game-screen">
        <div class="nav-header">
            <h1 id="turn-info">Spieler 1</h1>
            <div class="close-btn" id="game-close-btn"></div>
        </div>
        
        <div class="container">
            <div class="game-scene">
                <div class="cards-container" id="cards-container">
                    <div class="name-card">
                        <div class="player-name" id="current-player">Spieler 1</div>
                        <p class="tap-instruction">Wische nach oben oder tippe, um deine Rolle zu sehen</p>
                        <div class="swipe-instruction">
                            <div class="arrow-up"></div>
                            Wische nach oben
                        </div>
                    </div>
                    <div class="word-card">
                        <span class="category-badge" id="category-display">Kategorie</span>
                        <div id="role-reveal">
                            <div class="word-reveal" id="word-display">Wort</div>
                            <div class="hint-text" id="hint-text"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="game-footer">
                <div class="player-progress" id="progress-dots">
                    <!-- Progress dots will be generated here -->
                </div>
                <button class="btn hidden" id="next-player">N√§chster Spieler</button>
            </div>
        </div>
    </div>
    
    <!-- RESULT SCREEN -->
    <div class="screen" id="result-screen">
        <div class="nav-header">
            <h1>Ergebnis</h1>
            <div class="close-btn" id="result-close-btn"></div>
        </div>
        
        <div class="container result-screen">
            <div class="question-mark">?</div>
            <p class="imposter-reveal">Wer ist der Imposter?</p>
            <button class="btn" id="reveal-imposter">Imposter aufdecken</button>
            
            <div id="imposter-result" class="card hidden">
                <h2>Der Imposter war:</h2>
                <div class="word-reveal" id="imposter-name"></div>
                <p>Das Wort war: <span id="real-word"></span></p>
            </div>
            
            <button class="btn hidden" id="restart-game">Neu starten</button>
        </div>
        
        <div id="confetti-container"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Game variables
            let playerCount = 3;
            let imposterCount = 1;
            let imposterTips = false;
            let currentPlayerIndex = 0;
            let players = [];
            let imposters = [];
            let selectedWord = "";
            let selectedCategory = "";
            let imposterWord = "";
            let savedPlayerNames = {};
            let selectedCategories = [];
            let isDarkTheme = false;
            
            // DOM elements - Main screens
            const homeScreen = document.getElementById('home-screen');
            const gameScreen = document.getElementById('game-screen');
            const resultScreen = document.getElementById('result-screen');
            
            // DOM elements - Home screen
            const playersContainer = document.getElementById('players-container');
            const playerCountDisplay = document.getElementById('player-count');
            const imposterCountDisplay = document.getElementById('imposter-count');
            const imposterTipsToggle = document.getElementById('imposter-tips');
            const startGameButton = document.getElementById('start-game');
            const categoryCheckboxes = document.querySelectorAll('.category-checkbox input');
            const selectAllCategoriesBtn = document.getElementById('select-all-categories');
            const deselectAllCategoriesBtn = document.getElementById('deselect-all-categories');
            const themeToggle = document.getElementById('theme-toggle');
            
            // DOM elements - Game screen
            const turnInfo = document.getElementById('turn-info');
            const currentPlayerDisplay = document.getElementById('current-player');
            const nextPlayerButton = document.getElementById('next-player');
            const cardsContainer = document.getElementById('cards-container');
            const wordDisplay = document.getElementById('word-display');
            const categoryDisplay = document.getElementById('category-display');
            const hintText = document.getElementById('hint-text');
            const progressDotsContainer = document.getElementById('progress-dots');
            
            // DOM elements - Result screen
            const revealImposterButton = document.getElementById('reveal-imposter');
            const restartGameButton = document.getElementById('restart-game');
            const imposterResultCard = document.getElementById('imposter-result');
            const imposterNameDisplay = document.getElementById('imposter-name');
            const realWordDisplay = document.getElementById('real-word');
            
            // Initialize the game
            init();
            
            function init() {
                // Load saved player names from localStorage
                loadPlayerNames();
                
                // Load theme preference
                loadThemePreference();
                
                // Set up event listeners
                setupEventListeners();
                
                // Update player input fields
                updatePlayerFields();
                
                // Initialize category selection
                initCategories();
            }
            
            function loadPlayerNames() {
                const savedNames = localStorage.getItem('imposterGamePlayerNames');
                if (savedNames) {
                    savedPlayerNames = JSON.parse(savedNames);
                }
            }
            
            function savePlayerNames() {
                for (let i = 1; i <= playerCount; i++) {
                    const playerInput = document.getElementById(`player-${i}`);
                    if (playerInput && playerInput.value) {
                        savedPlayerNames[i] = playerInput.value;
                    }
                }
                localStorage.setItem('imposterGamePlayerNames', JSON.stringify(savedPlayerNames));
            }
            
            function loadThemePreference() {
                const savedTheme = localStorage.getItem('imposterGameTheme');
                if (savedTheme === 'dark') {
                    isDarkTheme = true;
                    document.body.classList.add('dark-theme');
                    if (themeToggle) themeToggle.checked = true;
                }
            }
            
            function saveThemePreference() {
                localStorage.setItem('imposterGameTheme', isDarkTheme ? 'dark' : 'light');
            }
            
            function setupEventListeners() {
                // Player count buttons
                document.getElementById('decrease-players').addEventListener('click', function() {
                    if (playerCount > 3) {
                        playerCount--;
                        updatePlayerFields();
                    }
                });
                
                document.getElementById('increase-players').addEventListener('click', function() {
                    playerCount++;
                    updatePlayerFields();
                });
                
                // Imposter count buttons
                document.getElementById('decrease-imposters').addEventListener('click', function() {
                    if (imposterCount > 1) {
                        imposterCount--;
                        imposterCountDisplay.textContent = imposterCount;
                    }
                });
                
                document.getElementById('increase-imposters').addEventListener('click', function() {
                    if (imposterCount < Math.floor(playerCount / 2)) {
                        imposterCount++;
                        imposterCountDisplay.textContent = imposterCount;
                    }
                });
                
                // Tips toggle
                if (imposterTipsToggle) {
                    imposterTipsToggle.addEventListener('change', function() {
                        imposterTips = this.checked;
                    });
                }
                
                // Category checkboxes
                categoryCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', updateSelectedCategories);
                });
                
                // Select/Deselect All buttons
                if (selectAllCategoriesBtn) {
                    selectAllCategoriesBtn.addEventListener('click', selectAllCategories);
                }
                
                if (deselectAllCategoriesBtn) {
                    deselectAllCategoriesBtn.addEventListener('click', deselectAllCategories);
                }
                
                // Theme toggle
                if (themeToggle) {
                    themeToggle.addEventListener('change', function() {
                        isDarkTheme = this.checked;
                        document.body.classList.toggle('dark-theme', isDarkTheme);
                        saveThemePreference();
                    });
                }
                
                // Start game button
                if (startGameButton) {
                    startGameButton.addEventListener('click', startGame);
                }
                
                // Next player button
                if (nextPlayerButton) {
                    nextPlayerButton.addEventListener('click', function() {
                        // Remove flipped class first to reset card orientation
                        cardsContainer.classList.remove('cards-flipped');
                        
                        // Add a short delay before showing the next player
                        setTimeout(() => {
                            currentPlayerIndex++;
                            
                            if (currentPlayerIndex < playerCount) {
                                showCurrentPlayer();
                                updateProgressDots();
                            } else {
                                switchScreen(gameScreen, resultScreen);
                            }
                        }, 300); // Short delay to ensure the card flip animation is completed
                    });
                }
                
                // Card flipping via touch/mouse events
                if (cardsContainer) {
                    let touchStartY = 0;
                    let touchEndY = 0;
                    
                    cardsContainer.addEventListener('touchstart', function(e) {
                        touchStartY = e.changedTouches[0].screenY;
                    }, { passive: true });
                    
                    cardsContainer.addEventListener('touchend', function(e) {
                        touchEndY = e.changedTouches[0].screenY;
                        handleSwipe();
                    }, { passive: true });
                    
                    // Also add click support for desktop testing
                    cardsContainer.addEventListener('click', function() {
                        if (!cardsContainer.classList.contains('cards-flipped')) {
                            cardsContainer.classList.add('cards-flipped');
                            nextPlayerButton.classList.remove('hidden');
                        }
                    });
                }
                
                // Reveal imposter button
                if (revealImposterButton) {
                    revealImposterButton.addEventListener('click', revealImposter);
                }
                
                // Restart game button
                if (restartGameButton) {
                    restartGameButton.addEventListener('click', function() {
                        switchScreen(resultScreen, homeScreen);
                        resetResultScreen();
                    });
                }
                
                // Close buttons
                document.querySelectorAll('.close-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const parentScreen = this.closest('.screen');
                        if (parentScreen && confirm('M√∂chtest du wirklich zum Hauptmen√º zur√ºckkehren? Das aktuelle Spiel wird beendet.')) {
                            switchScreen(parentScreen, homeScreen);
                            if (parentScreen === resultScreen) {
                                resetResultScreen();
                            }
                        }
                    });
                });
            }
            
            function updatePlayerFields() {
                playerCountDisplay.textContent = playerCount;
                playersContainer.innerHTML = '';
                
                for (let i = 1; i <= playerCount; i++) {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'player-input';
                    
                    // Use saved name if available, otherwise use default
                    const savedName = savedPlayerNames[i] || `Spieler ${i}`;
                    
                    playerDiv.innerHTML = `
                        <label for="player-${i}">Spieler ${i}:</label>
                        <input type="text" id="player-${i}" placeholder="Name eingeben" value="${savedName}">
                    `;
                    playersContainer.appendChild(playerDiv);
                }
                
                // Update max imposter count
                const maxImposters = Math.floor(playerCount / 2);
                if (imposterCount > maxImposters) {
                    imposterCount = maxImposters;
                    imposterCountDisplay.textContent = imposterCount;
                }
            }
            
            function updateProgressDots() {
                if (!progressDotsContainer) return;
                
                progressDotsContainer.innerHTML = '';
                
                for (let i = 0; i < playerCount; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'progress-dot';
                    if (i <= currentPlayerIndex) {
                        dot.classList.add('active');
                    }
                    progressDotsContainer.appendChild(dot);
                }
            }
            
            function initCategories() {
                // By default, select all categories
                categoryCheckboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
                updateSelectedCategories();
            }
            
            function updateSelectedCategories() {
                selectedCategories = [];
                categoryCheckboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selectedCategories.push(checkbox.value);
                    }
                });
                
                // Update the start button state
                const canStart = selectedCategories.length > 0;
                startGameButton.disabled = !canStart;
                startGameButton.classList.toggle('btn-disabled', !canStart);
            }
            
            function selectAllCategories() {
                categoryCheckboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
                updateSelectedCategories();
            }
            
            function deselectAllCategories() {
                categoryCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                updateSelectedCategories();
            }
            
            function startGame() {
                showLoading();
                
                // Small delay to show loading animation
                setTimeout(() => {
                    // Save player names to localStorage
                    savePlayerNames();
                    
                    // Collect player names
                    players = [];
                    for (let i = 1; i <= playerCount; i++) {
                        const playerInput = document.getElementById(`player-${i}`);
                        players.push({
                            name: playerInput.value || `Spieler ${i}`,
                            isImposter: false
                        });
                    }
                    
                    // Choose a random category from selected categories
                    if (selectedCategories.length === 0) {
                        // If no categories are selected, select all of them
                        selectedCategories = Array.from(categoryCheckboxes).map(cb => cb.value);
                    }
                    
                    const randomCategoryIndex = Math.floor(Math.random() * selectedCategories.length);
                    selectedCategory = selectedCategories[randomCategoryIndex];
                    
                    // Get random word
                    selectedWord = getRandomWord(selectedCategory);
                    
                    // Choose imposters
                    imposters = [];
                    const playerIndices = Array.from({length: playerCount}, (_, i) => i);
                    for (let i = 0; i < imposterCount; i++) {
                        const randomIndex = Math.floor(Math.random() * playerIndices.length);
                        const imposterIndex = playerIndices.splice(randomIndex, 1)[0];
                        players[imposterIndex].isImposter = true;
                        imposters.push(imposterIndex);
                    }
                    
                    // Choose a similar word for imposter if tips are enabled
                    if (imposterTips) {
                        imposterWord = getSimilarWord(selectedCategory, selectedWord);
                    }
                    
                    // Reset game state
                    currentPlayerIndex = 0;
                    
                    // Switch to game screen
                    switchScreen(homeScreen, gameScreen);
                    
                    // Show the first player
                    showCurrentPlayer();
                    
                    // Initialize progress dots
                    updateProgressDots();
                    
                    hideLoading();
                }, 500);
            }
            
            // Simplified word data
            const wordData = {
                "Tiere": ["Elefant", "Giraffe", "L√∂we", "Tiger", "Zebra", "Nashorn", "Gorilla", "K√§nguru",
                    "Koala", "Panda", "Eisb√§r", "Pinguin", "Delfin", "Wal", "Hai", "Schildkr√∂te",
                    "Krokodil", "Adler", "Papagei", "Pfau", "Eule", "Hund", "Katze", "Hamster",
                    "Kaninchen", "Meerschweinchen", "Eidechse", "Igel", "Fuchs", "Wolf"],
                
                "Essen": ["Pizza", "Hamburger", "Pasta", "Sushi", "Ramen", "Taco", "Burrito", "D√∂ner", 
                    "Currywurst", "Bratwurst", "Schnitzel", "Brot", "Br√∂tchen", "Brezel",
                    "Croissant", "Donut", "Kuchen", "Torte", "Eis", "Schokolade", "Gummib√§rchen", 
                    "Popcorn", "Pommes", "Kartoffeln", "Reis", "Nudeln", "Salat", "K√§se"],
                
                "L√§nder": ["Deutschland", "Frankreich", "Italien", "Spanien", "Portugal", "Gro√übritannien", 
                    "Niederlande", "Belgien", "Schweiz", "√ñsterreich", "Polen", "D√§nemark",
                    "Norwegen", "Schweden", "Finnland", "Griechenland", "T√ºrkei", "Russland", 
                    "USA", "Kanada", "Mexiko", "Brasilien", "Japan", "China", "Indien",
                    "Australien", "√Ñgypten", "S√ºdafrika", "Thailand", "Indonesien"],
                
                "St√§dte": ["Berlin", "Hamburg", "M√ºnchen", "K√∂ln", "Frankfurt", "Stuttgart", "D√ºsseldorf", 
                    "Dresden", "Leipzig", "N√ºrnberg", "Paris", "London", "Rom", "Madrid", "Barcelona", 
                    "Amsterdam", "Br√ºssel", "Wien", "Prag", "Warschau", "Z√ºrich", "Stockholm", 
                    "New York", "Los Angeles", "Tokyo", "Peking", "Sydney", "Kairo", "Dubai"],
                
                "Berufe": ["Arzt", "Lehrer", "Ingenieur", "Architekt", "Programmierer",
                    "Designer", "K√ºnstler", "Musiker", "Schauspieler", "Autor", "Journalist",
                    "Koch", "Friseur", "Polizist", "Feuerwehrmann", "Pilot", "Busfahrer", 
                    "Mechaniker", "Elektriker", "Tischler", "G√§rtner", "Anwalt", "Richter"],
                
                "Sport": ["Fu√üball", "Basketball", "Handball", "Volleyball", "Tennis", "Badminton",
                    "Golf", "Hockey", "Eishockey", "Baseball", "Leichtathletik",
                    "Schwimmen", "Surfen", "Skifahren", "Snowboarden", "Skaten", "Reiten", 
                    "Boxen", "Judo", "Karate", "Yoga", "Tanzen", "Turnen", "Klettern",
                    "Radfahren", "Formel 1", "Darts", "Schach"],
                
                "Filme & Serien": ["Star Wars", "Marvel", "Avengers", "Batman", "Harry Potter",
                    "Herr der Ringe", "Game of Thrones", "Breaking Bad", "Stranger Things", "Friends",
                    "Simpsons", "Titanic", "Jurassic Park", "James Bond", "Matrix", 
                    "Terminator", "Fluch der Karibik", "Shrek", "Toy Story", "Findet Nemo", 
                    "K√∂nig der L√∂wen", "Walking Dead", "Dexter"],
                
                "Musik": ["Rock", "Pop", "Hip-Hop", "Jazz", "Blues", "Country", "Folk",
                    "Klassik", "Techno", "House", "Reggae", "Punk", "Metal", 
                    "Indie", "Beatles", "Queen", "ABBA", "Michael Jackson",
                    "Madonna", "Elvis Presley", "David Bowie", "Beyonc√©", "Lady Gaga",
                    "Adele", "Ed Sheeran", "Taylor Swift", "Rihanna", "Mozart", "Beethoven"],
                
                "Technologie": ["Smartphone", "Computer", "Laptop", "Tablet", "Smartwatch", "Spielkonsole",
                    "Fernseher", "Kamera", "Kopfh√∂rer", "Lautsprecher", "Mikrofon",
                    "USB-Stick", "Festplatte", "Tastatur", "Maus", "Router", "WLAN", "Bluetooth", 
                    "Internet", "Cloud", "Software", "App", "Windows", "Apple", "Google", "Amazon", 
                    "Facebook", "Instagram", "Twitter", "YouTube", "Netflix"],
                
                "Videospiele": ["Minecraft", "Fortnite", "Call of Duty", "Counter-Strike", "Overwatch",
                    "League of Legends", "World of Warcraft", "GTA", "FIFA", "Mario",
                    "Zelda", "Pok√©mon", "Animal Crossing", "Sims", "Assassin's Creed", 
                    "Resident Evil", "Final Fantasy", "Metal Gear Solid", "God of War", 
                    "Sonic", "Street Fighter", "Mortal Kombat"],
                
                "Superhelden": ["Superman", "Batman", "Spider-Man", "Iron Man", "Captain America", 
                    "Thor", "Hulk", "Black Widow", "Black Panther", "Doctor Strange", 
                    "Captain Marvel", "Wonder Woman", "Flash", "Aquaman", "Green Lantern",
                    "Wolverine", "Deadpool", "Professor X", "Magneto", "Storm"],
                    
                "Kleidung": ["T-Shirt", "Hemd", "Bluse", "Pullover", "Hoodie", "Sweatshirt", 
                    "Jacke", "Mantel", "Blazer", "Jeans", "Hose", "Shorts", "Rock", "Kleid", 
                    "Anzug", "Krawatte", "Socken", "Unterw√§sche", "Badeanzug", "Bikini", 
                    "M√ºtze", "Hut", "Kappe", "Schal", "Handschuhe", "G√ºrtel", "Sneaker", 
                    "Stiefel", "Sandalen", "High Heels"]
            };
            
            // Similar words for imposter tips
            const similarWords = {
                "Pizza": ["Pasta", "Lasagne", "Calzone"],
                "Hamburger": ["Cheeseburger", "Sandwich", "Hotdog"],
                "Elefant": ["Nashorn", "Nilpferd", "Mammut"],
                "L√∂we": ["Tiger", "Leopard", "Gepard"],
                "Deutschland": ["√ñsterreich", "Schweiz", "Belgien"],
                "USA": ["Kanada", "Mexiko", "Kuba"],
                "Berlin": ["Hamburg", "M√ºnchen", "Frankfurt"],
                "Paris": ["London", "Rom", "Madrid"],
                "Fu√üball": ["Handball", "Basketball", "Volleyball"],
                "Tennis": ["Badminton", "Tischtennis", "Squash"],
                "Star Wars": ["Star Trek", "Avengers", "Herr der Ringe"],
                "Breaking Bad": ["Game of Thrones", "Walking Dead", "Stranger Things"],
                "Rock": ["Pop", "Metal", "Punk"],
                "Hip-Hop": ["Rap", "R&B", "Reggae"],
                "Smartphone": ["Tablet", "Laptop", "Computer"],
                "Facebook": ["Instagram", "Twitter", "Snapchat"],
                "Minecraft": ["Fortnite", "Roblox", "Terraria"],
                "FIFA": ["PES", "NBA 2K", "Madden NFL"],
                "Superman": ["Batman", "Spider-Man", "Wonder Woman"],
                "Thor": ["Hulk", "Iron Man", "Captain America"],
                "T-Shirt": ["Hemd", "Pullover", "Hoodie"],
                "Jeans": ["Hose", "Shorts", "Rock"]
            };
            
            function getRandomWord(category) {
                const words = wordData[category] || [];
                if (words.length === 0) return "Kein Wort gefunden";
                
                const randomIndex = Math.floor(Math.random() * words.length);
                return words[randomIndex];
            }
            
            function getSimilarWord(category, mainWord) {
                // Try to get a specific similar word
                if (similarWords[mainWord] && similarWords[mainWord].length > 0) {
                    const similarOptions = similarWords[mainWord];
                    return similarOptions[Math.floor(Math.random() * similarOptions.length)];
                }
                
                // Fallback: get another word from the same category
                const words = wordData[category].filter(word => word !== mainWord);
                if (words.length === 0) return "Kein √§hnliches Wort";
                
                return words[Math.floor(Math.random() * words.length)];
            }
            
            function showCurrentPlayer() {
                const player = players[currentPlayerIndex];
                
                turnInfo.textContent = player.name;
                currentPlayerDisplay.textContent = player.name;
                
                // Reset card flipped state
                cardsContainer.classList.remove('cards-flipped');
                
                // Reset the next player button
                nextPlayerButton.classList.add('hidden');
                
                // Show appropriate word based on player role
                if (player.isImposter) {
                    if (imposterTips) {
                        wordDisplay.innerHTML = imposterWord;
                        hintText.innerHTML = `Du bist der <span class="imposter-text">IMPOSTER</span>!<br>Dieses Wort ist ein Tipp.`;
                    } else {
                        wordDisplay.innerHTML = `<span class="imposter-text">IMPOSTER</span>`;
                        hintText.textContent = `Finde heraus, was die anderen wissen!`;
                    }
                } else {
                    wordDisplay.textContent = selectedWord;
                    hintText.textContent = '';
                }
                
                // Update category display
                categoryDisplay.textContent = selectedCategory;
            }
            
            function handleSwipe() {
                if (touchStartY - touchEndY > 70) { // Swipe up
                    cardsContainer.classList.add('cards-flipped');
                    nextPlayerButton.classList.remove('hidden');
                } else if (touchEndY - touchStartY > 70) { // Swipe down
                    cardsContainer.classList.remove('cards-flipped');
                }
            }
            
            function revealImposter() {
                imposterResultCard.classList.remove('hidden');
                this.classList.add('hidden');
                
                // Show imposter names
                const imposterNames = imposters.map(index => players[index].name).join(", ");
                imposterNameDisplay.textContent = imposterNames;
                realWordDisplay.textContent = selectedWord;
                
                restartGameButton.classList.remove('hidden');
                
                // Create confetti effect
                createConfetti();
            }
            
            function resetResultScreen() {
                imposterResultCard.classList.add('hidden');
                revealImposterButton.classList.remove('hidden');
                restartGameButton.classList.add('hidden');
            }
            
            function switchScreen(fromScreen, toScreen) {
                fromScreen.classList.remove('active');
                toScreen.classList.add('active');
                
                // Apply fade-in effect
                toScreen.classList.add('fade-in');
                setTimeout(() => {
                    toScreen.classList.remove('fade-in');
                }, 500);
            }
            
            function showLoading() {
                const loadingOverlay = document.createElement('div');
                loadingOverlay.className = 'loading-overlay';
                loadingOverlay.innerHTML = '<div class="loader"></div>';
                document.body.appendChild(loadingOverlay);
            }
            
            function hideLoading() {
                const loadingOverlay = document.querySelector('.loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.remove();
                }
            }
            
            function createConfetti() {
                const confettiContainer = document.getElementById('confetti-container');
                if (!confettiContainer) return;
                
                const colors = ['#f94144', '#f3722c', '#f8961e', '#f9844a', '#f9c74f', 
                                '#90be6d', '#43aa8b', '#4d908e', '#577590', '#277da1'];
                
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = confetti.style.width;
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                    confetti.style.animationDelay = Math.random() * 5 + 's';
                    
                    confettiContainer.appendChild(confetti);
                    
                    // Remove confetti after animation
                    setTimeout(() => {
                        confetti.remove();
                    }, 7000);
                }
            }
        });
    </script>
</body>
</html>
